'use strict';function _interopDefault(a){return a&&"object"==typeof a&&"default"in a?a["default"]:a}var React=_interopDefault(require("react")),mobx=require("mobx"),DateTimeConverter=_interopDefault(require("jb-modules/DateTimeModule/dist/DateTimeConverter.cjs.min")),mobxReact=require("mobx-react");require("./JBDateInput.css");var _class,_descriptor,_descriptor2,_descriptor3,_temp;function _initializerDefineProperty(a,b,c,d){c&&Object.defineProperty(a,b,{enumerable:c.enumerable,configurable:c.configurable,writable:c.writable,value:c.initializer?c.initializer.call(d):void 0})}function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function _defineProperties(a,b){for(var c,d=0;d<b.length;d++)c=b[d],c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(a,c.key,c)}function _createClass(a,b,c){return b&&_defineProperties(a.prototype,b),c&&_defineProperties(a,c),a}function _applyDecoratedDescriptor(a,b,c,d,e){var f={};return Object.keys(d).forEach(function(a){f[a]=d[a]}),f.enumerable=!!f.enumerable,f.configurable=!!f.configurable,("value"in f||f.initializer)&&(f.writable=!0),f=c.slice().reverse().reduce(function(c,d){return d(a,b,c)||c},f),e&&void 0!==f.initializer&&(f.value=f.initializer?f.initializer.call(e):void 0,f.initializer=void 0),void 0===f.initializer&&(Object.defineProperty(a,b,f),f=null),f}var _class$1,JBDateInputService=(_class=(_temp=function(){function a(b){var c=this;_classCallCheck(this,a),_initializerDefineProperty(this,"componentStatus",_descriptor,this),_initializerDefineProperty(this,"elements",_descriptor2,this),_initializerDefineProperty(this,"defaultConfig",_descriptor3,this),this.config=null,this.valueString="",this.isValid=!1,this.errorMessage="",this.onKeyPressEvent=void 0,this.onSubmitEvent=void 0,this.gregorianDateObj=null;mobx.observe(this.componentStatus,function(a){return c.onComponentStatusFocusChange(a)});this.config=this.mergeObject(b.config,this.defaultConfig),this.onChangeEvent=b.onChange,this.onKeyPressEvent=b.onKeyPress||function(){},this.onSubmitEvent=b.onSubmit||function(){},this.valueString=b.value,!0==b.autoFocus&&(this.config.autoFocus=!0),this.inputMaskToRegex()}return _createClass(a,[{key:"mergeObject",value:function(a,b){var c={};for(var d in b)(null==a[d]||null==a[d])&&(c[d]=b[d]);return mobx.extendObservable(a,c),a}},{key:"inputMaskToRegex",value:function(){var a=this.config.inputMask.replace("yyyy","(?<year>\\d{4})").replace("MM","(?<month>\\d{2})").replace("dd","(?<day>\\d{2})").replace("HH","(?<hour>\\d{2})").replace("mm","(?<minute>\\d{2})").replace("ss","(?<second>\\d{2})").replace(".SSS","(?:.(?<milliSecond>\\d{1,3})){0,1}").replace("SSS","(?<milliSecond>\\d{1,3})").replace("ZZ","(?<timeZone>([+-](?<timeZoneHour>2[0-3]|[01][0-9]):(?<timeZoneMinute>[0-5][0-9])){0,1})");this.config.inputMaskRegex=new RegExp(a,"g")}},{key:"updateCalendarValue",value:function(a){if(""!=this.valueString&&this.valueString){var b=this.decodeValueString(a),c=DateTimeConverter.convertGregorianToJalali(b.year,b.month,b.day);this.config.jalaliDateObj=c,this.valueString=a,this.updateUiValueByConfigData()}}},{key:"updateUiValueByConfigData",value:function(){if(this.elements.yearInput.current&&this.elements.monthInput.current&&this.elements.dayInput.current){this.elements.yearInput.current.value=this.config.jalaliDateObj.year;var a=this.config.jalaliDateObj.month;10>this.config.jalaliDateObj.month&&(a="0"+a),this.elements.monthInput.current.value=a;var b=this.config.jalaliDateObj.day;10>this.config.jalaliDateObj.day&&(b="0"+b),this.elements.dayInput.current.value=b}}},{key:"decodeValueString",value:function(a){this.config.inputMaskRegex.lastIndex=0;var b=this.config.inputMaskRegex.exec(a);return b.groups}},{key:"onYearInputFocus",value:function(){return this.componentStatus.focus="year",!0}},{key:"onMonthInputFocus",value:function(){return this.componentStatus.focus="month",!0}},{key:"onDayInputFocus",value:function(){return this.componentStatus.focus="day",!0}},{key:"onYearInputBlur",value:function(){return this.componentStatus.focus="",!0}},{key:"onMonthInputBlur",value:function(){return this.componentStatus.focus="",!0}},{key:"onDayInputBlur",value:function(){return this.componentStatus.focus="",!0}},{key:"onContainerClick",value:function(a){a.target==this.elements.inputBox.current&&(this.componentStatus.focus="year",this.elements.yearInput.current.setSelectionRange(0,0))}},{key:"onComponentStatusFocusChange",value:function(a){switch(a.object.focus){case"year":this.elements.yearInput.current.focus();break;case"month":this.elements.monthInput.current.focus();break;case"day":this.elements.dayInput.current.focus();break;case"":this.updateCalenderData();}}},{key:"onYearInputKeyPress",value:function(a){var b=this.elements.yearInput.current.selectionStart,c=a.key;return 4==b?(this.componentStatus.focus="month","/"==c?this.elements.monthInput.current.setSelectionRange(0,0):this.InputChartoBox(c,this.elements.monthInput.current,0)):this.InputChartoBox(c,this.elements.yearInput.current,b),this.onKeyPressEvent(a),a.preventDefault(),!1}},{key:"onMonthInputKeyPress",value:function(a){var b=this.elements.monthInput.current.selectionStart,c=a.key;return 2==b?(this.componentStatus.focus="day","/"==c?this.elements.dayInput.current.setSelectionRange(0,0):this.InputChartoBox(c,this.elements.dayInput.current,0)):this.InputChartoBox(c,this.elements.monthInput.current,b),this.onKeyPressEvent(a),a.preventDefault(),!1}},{key:"onDayInputKeyPress",value:function(a){var b=this.elements.dayInput.current.selectionStart,c=a.key;1<b&&(b=1),this.InputChartoBox(c,this.elements.dayInput.current,b),this.onKeyPressEvent(a),a.preventDefault()}},{key:"InputChartoBox",value:function(a,b,c){if(!isNaN(a)){if(b===this.elements.monthInput.current){if(1<parseInt(a)&&0==c&&(this.InputChartoBox("0",this.elements.monthInput.current,0),a=a,c++),1==c&&"1"==this.elements.monthInput.current.value[0]&&2<a)return;0==c&&"2"<this.elements.monthInput.current.value[1]&&"1"==a&&this.InputChartoBox("0",this.elements.monthInput.current,1)}if(b===this.elements.dayInput.current){if(3<parseInt(a)&&0==c&&(this.InputChartoBox("0",this.elements.dayInput.current,0),c++),1==c&&"3"==this.elements.dayInput.current.value[0]&&1<a)return;0==c&&"1"<this.elements.dayInput.current.value[1]&&"3"==a&&this.InputChartoBox("0",this.dayInput.current,1)}var d,e=b.value,f=b==this.elements.yearInput.current?4:2;d=e.length==f?1:0;var g=e.substr(0,c)+a+e.substr(c+d);b===this.elements.dayInput.current&&(this.config.jalaliDateObj.day=parseInt(g)),b===this.elements.monthInput.current&&(this.config.jalaliDateObj.month=parseInt(g)),b===this.elements.yearInput.current&&(this.config.jalaliDateObj.year=parseInt(g)),b.value=g,b.setSelectionRange(c+1,c+1)}}},{key:"onYearInputKeyDown",value:function(a){if(39==a.keyCode){var b=this.elements.yearInput.current.selectionStart;if(4==b)return this.componentStatus.focus="month",this.elements.monthInput.current.setSelectionRange(0,0),a.stopPropagation(),!1}return 38==a.keyCode&&this.addToDate(1,"year"),40==a.keyCode&&this.addToDate(-1,"year"),!0}},{key:"onMonthInputKeyDown",value:function(a){if(39==a.keyCode){var b=this.elements.monthInput.current.selectionStart;if(2==b)return this.componentStatus.focus="day",this.elements.dayInput.current.setSelectionRange(0,0),a.stopPropagation(),!1}if(37==a.keyCode){var b=this.elements.monthInput.current.selectionStart;if(0==b)return this.componentStatus.focus="year",this.elements.yearInput.current.setSelectionRange(4,4),a.stopPropagation(),!1}if(38==a.keyCode&&this.addToDate(1,"month"),40==a.keyCode&&this.addToDate(-1,"month"),8==a.keyCode){var b=this.elements.monthInput.current.selectionStart;0==b&&(this.componentStatus.focus="year",this.elements.yearInput.current.setSelectionRange(4,4))}return!0}},{key:"onDayInputKeyDown",value:function(a){if(37==a.keyCode){var b=this.elements.dayInput.current.selectionStart;if(0==b)return this.componentStatus.focus="month",this.elements.monthInput.current.setSelectionRange(2,2),a.stopPropagation(),!1}if(38==a.keyCode&&this.addToDate(1,"day"),40==a.keyCode&&this.addToDate(-1,"day"),8==a.keyCode){var b=this.elements.dayInput.current.selectionStart;0==b&&(this.componentStatus.focus="month",this.elements.monthInput.current.setSelectionRange(2,2))}return!0}},{key:"onYearInputKeyUp",value:function(a){13==a.keyCode&&this.validateDate()&&(this.updateCalenderData(),this.onSubmitEvent(a))}},{key:"onMonthInputKeyUp",value:function(a){13==a.keyCode&&this.validateDate()&&(this.updateCalenderData(),this.onSubmitEvent(a))}},{key:"onDayInputKeyUp",value:function(a){13==a.keyCode&&this.validateDate()&&(this.updateCalenderData(),this.onSubmitEvent(a))}},{key:"addToDate",value:function(a,b){switch(b){case"day":var c=parseInt(this.elements.dayInput.current.value);if(31>=c+a&&0<a){var d=c+a;10>d&&(d="0"+d),this.elements.dayInput.current.value=d,this.config.jalaliDateObj.day=d}if(0<c+a&&0>a){var e=c+a;10>e&&(e="0"+e),this.elements.dayInput.current.value=e,this.config.jalaliDateObj.day=e}break;case"month":var c=parseInt(this.elements.monthInput.current.value);if(12>=c+a&&0<a){var f=c+a;10>f&&(f="0"+f),this.elements.monthInput.current.value=f,this.config.jalaliDateObj.month=f}if(0<c+a&&0>a){var g=c+a;10>g&&(g="0"+g),this.elements.monthInput.current.value=g,this.config.jalaliDateObj.month=g}break;case"year":var c=parseInt(this.elements.yearInput.current.value);if(9999>c+a&&0<a){var h=c+a;this.elements.yearInput.current.value=h,this.config.jalaliDateObj.year=h}if(1e3<c+a&&0>a){var i=c+a;this.elements.yearInput.current.value=i}}this.updateCalenderData()}},{key:"updateCalenderData",value:function(){var a=this.config.jalaliDateObj.year,b=this.config.jalaliDateObj.month,c=this.config.jalaliDateObj.day;this.gregorianDateObj=DateTimeConverter.convertJalaliToGregorian(a,b,c);var d,e,f,g=this.gregorianDateObj.year,h=this.gregorianDateObj.month,i=this.gregorianDateObj.day;"gregorian"==this.config.InputDateType?(d=g,e=h,f=i):(d=a,e=b,f=c);var j=this.config.inputMask;j=j.replace("yyyy",d);var k=10>f?"0"+f:f;j=j.replace("dd",k);var l=10>e?"0"+e:e;j=j.replace("MM",l),j=j.replace("HH","12"),j=j.replace("mm","00"),j=j.replace("ss","00"),j=j.replace("SSS","000"),j=j.replace("ZZ","+00:00"),j=j.replace("aaa","AM"),this.config.value=j;var m=this.createEventDetailObject(j);"function"==typeof this.onChangeEvent&&this.callOnChangeEvent(j,m)}},{key:"createEventDetailObject",value:function(a){var b={jalaliDateObj:this.config.jalaliDateObj,gregorianDateObj:this.gregorianDateObj,value:a,isValid:this.validateDate(),errorMessage:this.errorMessage};return b}},{key:"callOnChangeEvent",value:function(a,b){var c=this,d=new CustomEvent("change",{detail:b,bubbles:!0,cancelable:!0});d.simulated=!0;var e=this.elements.componentDom.current._valueTracker;return e&&e.setValue(a),this.elements.componentDom.current.value=a,this.elements.componentDom.current.onchange=function(a){return c.onChangeEvent(a)},this.elements.componentDom.current.dispatchEvent(d),d}},{key:"validateDate",value:function(){this.isValid=!0,this.errorMessage="";var a=this.elements.yearInput.current.value,b=this.elements.monthInput.current.value,c=this.elements.dayInput.current.value;if((isNaN(a)&&(this.errorMessage="\u0645\u0642\u062F\u0627\u0631 \u0633\u0627\u0644 \u0648\u0627\u0631\u062F \u0634\u062F\u0647 \u0639\u062F\u062F\u06CC \u0646\u06CC\u0633\u062A",this.isValid=!1),isNaN(b)&&(this.errorMessage="\u0645\u0642\u062F\u0627\u0631 \u0645\u0627\u0647 \u0648\u0627\u0631\u062F \u0634\u062F\u0647 \u0639\u062F\u062F\u06CC \u0646\u06CC\u0633\u062A",this.isValid=!1),isNaN(c)&&(this.errorMessage="\u0645\u0642\u062F\u0627\u0631 \u0631\u0648\u0632 \u0648\u0627\u0631\u062F \u0634\u062F\u0647 \u0639\u062F\u062F\u06CC \u0646\u06CC\u0633\u062A",this.isValid=!1),!1!=this.isValid)&&(""==a&&(this.errorMessage="\u0633\u0627\u0644 \u062D\u062A\u0645\u0627 \u0645\u06CC\u0628\u0627\u06CC\u0633\u062A \u0648\u0627\u0631\u062F \u0634\u0648\u062F",this.isValid=!1),""==b&&(this.errorMessage="\u0645\u0627\u0647 \u062D\u062A\u0645\u0627 \u0645\u06CC\u0628\u0627\u06CC\u0633\u062A \u0648\u0627\u0631\u062F \u0634\u0648\u062F",this.isValid=!1),""==c&&(this.errorMessage="\u0631\u0648\u0632 \u062D\u062A\u0645\u0627 \u0645\u06CC\u0628\u0627\u06CC\u0633\u062A \u0648\u0627\u0631\u062F \u0634\u0648\u062F",this.isValid=!1),!1!=this.isValid)){var d=parseInt(b),e=parseInt(c);if(1>d||12<d)return this.errorMessage="\u0645\u0627\u0647 \u0648\u0627\u0631\u062F \u0634\u062F\u0647 \u062F\u0631 \u0628\u0627\u0632\u0647 \u0635\u062D\u06CC\u062D \u0646\u0645\u06CC \u0628\u0627\u0634\u062F",void(this.isValid=!1);if(1>e||31<e)return this.errorMessage="\u0631\u0648\u0632 \u0648\u0627\u0631\u062F \u0634\u062F\u0647 \u062F\u0631 \u0628\u0627\u0632\u0647 \u0635\u062D\u06CC\u062D \u0646\u0645\u06CC \u0628\u0627\u0634\u062F",void(this.isValid=!1);return[7,8,9,10,11,12].includes(d)&&31==e?(this.errorMessage="\u0645\u0627\u0647 \u0648\u0627\u0631\u062F \u0634\u062F\u0647 \u0633\u06CC \u0648 \u06CC\u06A9 \u0631\u0648\u0632\u0647 \u0646\u06CC\u0633\u062A ",void(this.isValid=!1)):this.isValid}}}]),a}(),_temp),_descriptor=_applyDecoratedDescriptor(_class.prototype,"componentStatus",[mobx.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return{focus:""}}}),_descriptor2=_applyDecoratedDescriptor(_class.prototype,"elements",[mobx.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return{componentDom:React.createRef(),yearInput:React.createRef(),monthInput:React.createRef(),dayInput:React.createRef(),inputBox:React.createRef()}}}),_descriptor3=_applyDecoratedDescriptor(_class.prototype,"defaultConfig",[mobx.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return{value:null,jalaliDateObj:{year:"null",month:null,day:null},InputDateType:"gregorian",inputMask:"yyyy-MM-ddTHH:mm:ss.SSSZZ",inputMaskRegex:null}}}),_class);function _typeof(a){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a},_typeof(a)}function _classCallCheck$1(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function _defineProperties$1(a,b){for(var c,d=0;d<b.length;d++)c=b[d],c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(a,c.key,c)}function _createClass$1(a,b,c){return b&&_defineProperties$1(a.prototype,b),c&&_defineProperties$1(a,c),a}function _possibleConstructorReturn(a,b){return b&&("object"===_typeof(b)||"function"==typeof b)?b:_assertThisInitialized(a)}function _assertThisInitialized(a){if(void 0===a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return a}function _getPrototypeOf(a){return _getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(a){return a.__proto__||Object.getPrototypeOf(a)},_getPrototypeOf(a)}function _inherits(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function");a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,writable:!0,configurable:!0}}),b&&_setPrototypeOf(a,b)}function _setPrototypeOf(a,b){return _setPrototypeOf=Object.setPrototypeOf||function(a,b){return a.__proto__=b,a},_setPrototypeOf(a,b)}var JBDateInput=mobxReact.observer(_class$1=function(a){function b(a){var c;return _classCallCheck$1(this,b),c=_possibleConstructorReturn(this,_getPrototypeOf(b).call(this,a)),c.service=new JBDateInputService(a),c}return _inherits(b,a),_createClass$1(b,[{key:"componentDidMount",value:function(){this.props.value&&""!=this.props.value&&this.service.updateCalendarValue(this.props.value),this.service.config.autoFocus&&this.service.elements.yearInput.current.focus()}},{key:"componentWillReceiveProps",value:function(a){this.service.valueString!=a.value&&this.service.updateCalendarValue(a.value)}},{key:"render",value:function(){var a=this;return React.createElement("div",{className:"jb-date-input-component "+this.props.className,ref:this.service.elements.componentDom,style:this.props.style},React.createElement("div",{className:"jb-date-input-box",ref:this.service.elements.inputBox,onClick:function(b){return a.service.onContainerClick(b)}},React.createElement("input",{onKeyDown:function(b){return a.service.onDayInputKeyDown(b)},onKeyPress:function(b){return a.service.onDayInputKeyPress(b)},ref:this.service.elements.dayInput,onKeyUp:function(b){return a.service.onDayInputKeyUp(b)},onFocus:function(b){return a.service.onDayInputFocus(b)},onBlur:function(b){return a.service.onDayInputBlur(b)},className:"day-input"}),React.createElement("span",{className:"slash-seperator"},"/"),React.createElement("input",{onKeyDown:function(b){return a.service.onMonthInputKeyDown(b)},onKeyPress:function(b){return a.service.onMonthInputKeyPress(b)},ref:this.service.elements.monthInput,onFocus:function(b){return a.service.onMonthInputFocus(b)},onBlur:function(b){return a.service.onMonthInputBlur(b)},className:"month-input"}),React.createElement("span",{className:"slash-seperator"},"/"),React.createElement("input",{onKeyDown:function(b){return a.service.onYearInputKeyDown(b)},onKeyPress:function(b){return a.service.onYearInputKeyPress(b)},ref:this.service.elements.yearInput,onFocus:function(b){return a.service.onYearInputFocus(b)},onBlur:function(b){return a.service.onYearInputBlur(b)},className:"year-input"})))}}]),b}(React.Component))||_class$1;module.exports=JBDateInput;
